<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>ISeeAdmin 【首页】 </title>
    <link rel="stylesheet" href="/static/element/index.css">
    <link rel="stylesheet" href="/static/css/common.css">
    <script src="/static/js/menu.js"></script>
    <script src="/static/js/init.js"></script>
    <script src="/static/js/vue.js"></script>
    <!--    <script src="/static/js/vue.min.js"></script>-->
    <!--    <script src="static/js/axios.min.js"></script>-->
    <script src="/static/element/index.js"></script>
</head>
<body>
<div id="app" v-cloak>
    <el-container style="height: 100%;min-height:100vh;">
        <el-aside width="210px">
            <div class="aside-logo">
                <img class="aside-logo-img" src="https://wpimg.wallstcn.com/69a1c46c-eb1c-4b46-8bd4-e9e686ef5251.png"
                     alt=""> ISeeAdmin
            </div>
            <el-menu @select="iseeMenuOpen" style="width: 210px;" unique-opened
                     :default-active="iseeData.defaultActive"
                     background-color="#304156"
                     text-color="#bfcbd9"
                     active-text-color="#409eff">

                <template v-for="(item,index) in iseeData.menu">
                    <template v-if="!item.children.length">
                        <el-menu-item :index="item.url"><i :class="item.icon"></i>{{item.title}}</el-menu-item>
                    </template>
                    <template v-else>
                        <el-submenu :index="item.url">
                            <template slot="title"><i :class="item.icon"></i>{{item.title}}</template>
                            <template v-for="(itemSub,indexSub) in item.children" :index="itemSub.index">
                                <template v-if="itemSub.children.length">
                                    <el-submenu :index="itemSub.url">
                                        <span slot="title"><i :class="itemSub.icon"></i>{{ itemSub.title }}</span>
                                        <template v-for="(itemSub_,indexSub_) in itemSub.children">
                                            <el-menu-item :index="itemSub_.url"><i :class="itemSub_.icon"></i>{{
                                                itemSub_.title }}
                                            </el-menu-item>
                                        </template>
                                    </el-submenu>
                                </template>
                                <template v-else>
                                    <el-menu-item :index="itemSub.url"><i :class="itemSub.icon"></i>{{ itemSub.title }}
                                    </el-menu-item>
                                </template>
                            </template>
                        </el-submenu>
                    </template>
                </template>

            </el-menu>
        </el-aside>

        <el-container>

            <el-header height="78px">
                <div>
                    <el-breadcrumb style="line-height: 50px" separator="/">
                        <el-breadcrumb-item v-for="(item,index) in iseeData.breadcrumb" :key="index">{{item.title}}
                        </el-breadcrumb-item>
                    </el-breadcrumb>
                </div>
                <div style="display: flex">
                    <div style="width: 100%">
                        <el-tag style="cursor:pointer;margin-right: 5px;" v-for="(item,index) in iseeData.tagList"
                                :key="index"
                                @click="iseeTagSwitch(item.url,index)"
                                :effect="item.effect"
                                :type="item.type"
                                @close="iseeTagClose(item.url,index)"
                                size="small"
                                :closable="item.closable"><i v-show="item.show" class="el-icon-view"></i> {{item.title}}
                        </el-tag>
                    </div>
                    <div style="float: right;">
                        <el-dropdown @command="iseeTagCommandClose">
                          <span class="el-dropdown-link">
                              <i class="el-icon-arrow-down el-icon--right"></i>
                          </span>
                            <el-dropdown-menu slot="dropdown">
                                <el-dropdown-item command="1">关闭当前标签页</el-dropdown-item>
                                <el-dropdown-item command="2">关闭其它标签页</el-dropdown-item>
                                <el-dropdown-item command="3">关闭全部标签页</el-dropdown-item>
                            </el-dropdown-menu>
                        </el-dropdown>
                    </div>
                </div>
            </el-header>

            <el-main>
                <el-table :data="tableData">
                    <el-table-column prop="date" label="日期" width="140">
                    </el-table-column>
                    <el-table-column prop="name" label="姓名" width="120">
                    </el-table-column>
                    <el-table-column prop="address" label="地址">
                    </el-table-column>
                </el-table>
            </el-main>
        </el-container>
    </el-container>
</div>


<script>
  const item = {
    date: '2016-05-02',
    name: '王小虎',
    address: '上海市普陀区金沙江路 1518 弄'
  };
  var app = new Vue({
    el: '#app',
    data: {
      tableData: Array(10).fill(item),

      iseeData: {
        status: false,
        show: true,
        defaultActive: iseeDefaultActive,
        menu: iseeMenu,
        tagList: iseeTagList,
        currentTitle: '首页',
        breadcrumb: [{
          url: '',
          title: '面板'
        }, {
          url: '/',
          title: '首页'
        }
        ]
      },
    },
    methods: {
      iseeTagSwitch(url, index) {
        let currentUrl = this.$data.iseeData.defaultActive
        if (url == currentUrl) {
          return;
        }
        localStorage.setItem('iseeDefaultActive', url)
        window.open(url, '_self')
      },

      iseeTagClose(url, index) {
        this.$data.iseeData.tagList.splice(index, 1);
        localStorage.setItem('iseeTagList', JSON.stringify(this.$data.iseeData.tagList))
        // 关闭当前tag,跳转到前一个tag
        if (url == this.$data.iseeData.defaultActive) {
          localStorage.setItem('iseeDefaultActive', this.$data.iseeData.tagList[index - 1].url)
          window.open(this.$data.iseeData.tagList[index - 1].url, '_self')
        }
      },

      iseeTagCommandClose(command) {
        switch (command) {
          //关闭当前tag
          case '1':
            if (iseeHomeUrl != this.$data.iseeData.defaultActive) {
              this.$data.iseeData.tagList.forEach((obj, index) => {
                if (obj.url == this.$data.iseeData.defaultActive) {
                  this.$data.iseeData.tagList.splice(index, 1);
                  localStorage.setItem('iseeDefaultActive', this.$data.iseeData.tagList[index - 1].url)
                  localStorage.setItem('iseeTagList', JSON.stringify(this.$data.iseeData.tagList))
                  window.open(this.$data.iseeData.tagList[index - 1].url, '_self')
                }
              })
            }
            break
          //关闭其它tag
          case '2':
            //当前tag在首页上
            let tagListTemp = [isseHomeTag]
            if (iseeHomeUrl == this.$data.iseeData.defaultActive) {
              this.$data.iseeData.tagList = tagListTemp
            } else {
              tagListTemp[0].show = false
              tagListTemp[0].effect = 'plain'
              tagListTemp[0].type = 'info'
              this.$data.iseeData.tagList.forEach((obj) => {
                if (obj.url == this.$data.iseeData.defaultActive && obj.url != iseeHomeUrl) {
                  tagListTemp.push(obj)
                  return
                }
              })
              this.$data.iseeData.tagList = tagListTemp
            }
            localStorage.setItem('iseeTagList', JSON.stringify(this.$data.iseeData.tagList))
            break
          //关闭全部tag
          case '3':
            this.$data.iseeData.tagList = [isseHomeTag]
            localStorage.setItem('iseeTagList', JSON.stringify(this.$data.iseeData.tagList))
            // 当前tag不是首页
            if (iseeHomeUrl != this.$data.iseeData.defaultActive) {
              localStorage.setItem('iseeDefaultActive', iseeHomeUrl)
              window.open(iseeHomeUrl, '_self')
            }
            break
        }
      },

      iseeMenuOpen(key, keyPath) {
        localStorage.setItem('iseeDefaultActive', key)
        // key存在iseeTagList中,则iseeTagList无需再push
        this.$data.iseeData.tagList.forEach((obj) => {
          if (obj.url == key) {
            this.$data.iseeData.status = true
            return
          }
        })

        if (this.$data.iseeData.status == false) {
          let issTag = {
            title: '',
            url: key,
            closable: true,
            show: true,
            effect: 'dark',
            type: '',
          }
          this.$data.iseeData.tagList.push(issTag)
          localStorage.setItem('iseeTagList', JSON.stringify(this.$data.iseeData.tagList))
        }
        window.open(key, '_self')
      },
    },
    beforeMount() {
      this.$data.iseeData.tagList.forEach((obj) => {
        if (obj.url == this.$data.iseeData.defaultActive) {
          obj.title = this.$data.iseeData.currentTitle
          obj.show = true
          obj.effect = 'dark'
          obj.type = ''
          localStorage.setItem('iseeTagList', JSON.stringify(this.$data.iseeData.tagList))
        } else {
          obj.show = false
          obj.effect = 'plain'
          obj.type = 'info'
        }
      })
    },
    mounted() {
    }
  });
</script>
</body>
</html>

