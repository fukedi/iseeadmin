<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>about</title>
    <link rel="stylesheet" href="/static/element/index.css">
    <script src="/static/js/menu.js"></script>
    <script src="/static/js/init.js"></script>
    <script src="/static/js/vue.js"></script>
    <!--    <script src="static/js/axios.min.js"></script>-->
    <script src="/static/element/index.js"></script>
    <style>
        body {
            background-color: #DCDFE6;
            margin: 0px;
            padding: 0px;
        }

        .el-header {
            background-color: #fff;
            color: #333;
            border-bottom: 1px solid #d8dce5;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
        }

        .el-aside {
            /*width: 210px;*/
            overflow: hidden;
            background-color: #304156;
        }


        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <el-container style="height: 100%;min-height:100vh;">
        <el-aside width="210px">
            <el-menu @select="handleOpen" style="width: 210px;" unique-opened
                     :default-active="iseeDefaultActive"
                     background-color="#304156"
                     text-color="#bfcbd9"
                     active-text-color="#409eff">

                <template v-for="(item,index) in menu">
                    <template v-if="!item.children.length">
                        <el-menu-item :index="item.url"><i :class="item.icon"></i>{{item.title}}</el-menu-item>
                    </template>
                    <template v-else>
                        <el-submenu :index="index.toString()">
                            <template slot="title"><i class="el-icon-message"></i>{{item.title}}</template>
                            <template v-for="(itemSub,indexSub) in item.children" :index="itemSub.index">
                                <template v-if="itemSub.children.length">
                                    <el-submenu :index="indexSub.toString()">
                                        <span slot="title">{{ itemSub.title }}</span>
                                        <template v-for="(itemSub_,indexSub_) in itemSub.children">
                                            <el-menu-item :index="itemSub_.url">{{ itemSub_.title }}</el-menu-item>
                                        </template>
                                    </el-submenu>
                                </template>
                                <template v-else>
                                    <el-menu-item :index="itemSub.url">{{ itemSub.title }}</el-menu-item>
                                </template>
                            </template>
                        </el-submenu>
                    </template>
                </template>

            </el-menu>
        </el-aside>

        <el-container>

            <el-header height="78px">
                <div>
                    <el-breadcrumb style="line-height: 50px" separator="/">
                        <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
                        <el-breadcrumb-item>活动管理</el-breadcrumb-item>
                        <el-breadcrumb-item>活动列表</el-breadcrumb-item>
                    </el-breadcrumb>
                </div>
                <div>
                    <el-tag style="cursor:pointer;margin-right: 5px;" v-for="(item,index) in tagList" :key="index"
                            @click="pageSwitch(item.url,index)" :effect="item.effect" :type="item.type" size="small"
                            :closable="item.closable"><i v-show="item.show" class="el-icon-view"></i> {{item.title}}
                    </el-tag>
                </div>
            </el-header>

            <el-main>
                <el-table :data="tableData">
                    <el-table-column prop="date" label="日期" width="140">
                    </el-table-column>
                    <el-table-column prop="name" label="姓名" width="120">
                    </el-table-column>
                    <el-table-column prop="address" label="地址">
                    </el-table-column>
                </el-table>
            </el-main>
        </el-container>
    </el-container>
</div>


<script>
  const item = {
    date: '2016-05-02',
    name: '王小虎',
    address: '上海市普陀区金沙江路 1518 弄'
  };
  var app = new Vue({
    el: '#app',
    data: {
      tableData: Array(10).fill(item),
      show: true,
      iseeDefaultActive: iseeDefaultActive,
      menu: menu,
      tagList: iseeTagList,
      currentTitle:'商品分类',
    },
    beforeMount(){
      console.log('beforeMount')
      console.log(this.$data.iseeDefaultActive)
      this.$data.tagList.forEach((obj)=>{
        if(obj.url==this.$data.iseeDefaultActive){
          obj.title=this.$data.currentTitle
          localStorage.setItem('iseeTagList',JSON.stringify(this.$data.tagList))
        }else{
          obj.show = false
          obj.effect = 'plain'
          obj.type = 'info'
        }
      })
    },
    methods: {

      pageSwitch(url,index) {
        let currentUrl = this.$data.iseeDefaultActive
        if (url == currentUrl) {
          return;
        }
        localStorage.setItem('iseeDefaultActive',url)
        window.open(url, '_self')
        console.log(index)
      },

      handleOpen(key, keyPath) {
        localStorage.setItem('iseeDefaultActive', key)
        // key存在iseeTagList中,则iseeTagList无需再push
        iseeTagList.forEach((res) => {
          if (res.url == key) {
            this.$data.status = true
            return
          }
        })

        if (this.$data.status == false) {
          console.log(222222222)
          // this.$data.menu[]
          let issTag = {
            title: 'unknow',
            url: key,
            closable: true,
            show: true,
            effect: 'dark',
            type: '',
          }

          iseeTagList.push(issTag)
          localStorage.setItem('iseeTagList', JSON.stringify(iseeTagList))
        }

        console.log(111111111)
        console.log(iseeTagList.length)
        console.log(iseeTagList)
        console.log(44444444444)

        window.open(key, '_self')
        console.log(key);
        console.log(keyPath);
      },
    },
    mounted() {


      console.log(iseeTagList)
      // console.log(this.$data.tagList)
    }
  });
</script>
</body>
</html>

